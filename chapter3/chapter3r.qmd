# Chapter 2: Exploring Data Spread - Measures of Variability in R {.unnumbered}

In this section, we demonstrate how to compute and interpret measures of variability—**range, interquartile range (IQR), variance**, and **standard deviation**—using math achievement data from the U.S. sample in the Programme for International Student Assessment (PISA). We will use the PV1MATH variable (Math Plausible Value 1) as an illustrative example. 

```{r}
#| echo: true
#| message: false
#| warning: false
# Load required package 
library(haven) 
 
# Load the dataset 
data <- read_sav("chapter3/Clean-data_mar6.sav") 
 
# Extract the math plausible value 
math_achi <- data$PV1MATH 
```

## 1    Calculating the Range{.unnumbered}

The range shows the spread between the smallest and largest scores. 
```{r}
#| echo: true
#| message: false
#| warning: false
range_math <- range(math_achi) #return the minimum and maximum values 
range_math 
```

```{r}
#| echo: true
#| message: false
#| warning: false
range_diff <- diff(range_math) #calculate the difference between the two values 
range_diff 
```

## 2    Calculating the Interquartile Range (IQR) {.unnumbered}
IQR represents the middle 50% of the scores and is more robust to outliers. 
```{r}
#| echo: true
#| message: false
#| warning: false
iqr_math <- IQR(math_achi) # Calculate the IQR 
iqr_math 
```

```{r}
#| echo: true
#| message: false
#| warning: false
#return the 1st quartile (25th percentile), median (50th percentile), and 3rd quartile (75th percentile) 
quantile(math_achi, probs = c(0.25, 0.5, 0.75)) 
```
# 3	    Calculating the Variance and Standard Deviation {.unnumbered}
Variance shows the average squared distance from the mean, and the standard deviation is its square root. By default, R calculates the *sample* variance and *sample* standard deviation, which divide by $(n - 1)$: 
```{r}
#| echo: true
#| message: false
#| warning: false
var_math <- var(math_achi) # Calculate the variance 
var_math 
```

```{r}
#| echo: true
#| message: false
#| warning: false
sd_math <- sd(math_achi) # Calculate the standard deviation 
sd_math 
```
If needed, we can approximate population variance from the sample variance using the following adjustment: 
```{r}
#| echo: true
#| message: false
#| warning: false
n <- sum(!is.na(math_achi))  
pop_var_math <- var_math * (n - 1) / n  # Convert sample variance to population variance 
pop_sd_math <- sqrt(pop_var_math) 
```
## 4    Visualizing the Distribution with Mean and SD {.unnumbered}
We can use a histogram to examine how the scores are spread around the mean. 
```{r}
#| echo: true
#| message: false
#| warning: false
library(ggplot2) 
mean_math <- mean(math_achi) 
 
# Plot with mean and ±1 SD 
ggplot(data.frame(math_achi), aes(x = math_achi)) + 
  geom_histogram(binwidth = 10, fill = "lightblue", color = "white") + 
  geom_vline(xintercept = mean_math, color = "red", linetype = "solid", size = 1) + 
  geom_vline(xintercept = mean_math + sd_math, color = "blue", linetype = "dashed") + 
  geom_vline(xintercept = mean_math - sd_math, color = "blue", linetype = "dashed") + 
  labs(title = "Distribution of Math Scores with Mean and ±1 SD", 
       x = "Math Scores (PV1MATH)", y = "Frequency") 
```
Let’s see how many students scored within 1, 2, and 3 standard deviations of the mean. 
```{r}
#| echo: true
#| message: false
#| warning: false
within_1sd <- mean(math_achi > (mean_math - sd_math) & math_achi < (mean_math + sd_math)) 
within_2sd <- mean(math_achi > (mean_math - 2*sd_math) & math_achi < (mean_math + 2*sd_math)) 
within_3sd <- mean(math_achi > (mean_math - 3*sd_math) & math_achi < (mean_math + 3*sd_math)) 
c(within_1sd, within_2sd, within_3sd) 
```
## 5    Interpreting Variability in Math Achievement Scores {.unnumbered}

### 5.1 5.1	Measures of Variability {.unnumbered}

The analysis of math achievement scores (PV1MATH) from the PISA U.S. dataset provides key insights into the distribution using measures of variability. 

- **Range** : The math scores in the U.S. sample range from 188.35 to 819.51, giving a total spread of 631.16 points. This wide range suggests a broad performance gap among students, though extreme scores may influence this value. 

- **Interquartile Range** : The IQR is 137.58, with the 25th percentile at 391.34 and the 75th percentile at 528.92. This indicates that the middle 50% of students scored within this 138-point window, providing a more stable summary of typical score spread. 

- **Variance** and **Standard Deviation**: The sample variance is 9049.61, and the standard deviation is 95.13. This tells us that, on average, individual scores deviate by about 95 points from the mean score.  

### 5.2	Visualizing Spread and Normality {.unnumbered}

The histogram confirms a roughly symmetric distribution centered around the mean, with the bulk of scores falling within one standard deviation. 

- About 66.1% of students scored within 1 SD of the mean (approximately between 366.74 and 557.00). 

- About 96.1% fell within 2 SDs, and 99.9% were within 3 SDs. 

These proportions align well with the 68-95-99.7% empirical rule, indicating that the distribution of math scores is approximately normal. 

In summary, these metrics offer a comprehensive picture of performance variation, helping educational researchers understand both how typical students perform and how much their scores vary. Such insights are essential for designing instruction, identifying gaps, and guiding data-informed decision-making. 